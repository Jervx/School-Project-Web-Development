let feed_data = new Array(); let feed_type; let maxFeed = 8; let prevFilter = "all"; let z = 0; function load() { doesLogin(); if (isLogin()) { document.getElementById("username").innerHTML = '<span class="bolder">User</span>: No User'; document.getElementById("feed-main-form").innerHTML += '<button onclick="callLogin()" class="btn">Login First To Send Feedback</button>'; } else { document.getElementById("feed-main-form").innerHTML += '<button class="btn" onclick="send_Feed()">Send Feedback</button>'; document.getElementById("username").innerHTML = '<span class="bolder">User</span>: ' + curUser.username; } loadFooter(); if (stor_get("feed_data") != null) { dataLoad(); } showFeeds("all"); } function dataLoad() { feed_data = JSON.parse(stor_get("feed_data")); z = feed_data.length - 1; } function callLogin() { stor_add("link_req", window.location.pathname.replace("/", "").toString()); gotologin(); } function showFeeds(type) { prevFilter = type; let container = document.getElementById("other-feeds"); z = feed_data.length; container.innerHTML = ''; let itr = 0, worked = 0; for (var t = z - 1; t >= 0; t--) { if (feed_data[t].type === type || type === "all") { container.innerHTML += '<div class="feedback-container"><div class="feedbacks-details-p"><p>SENT BY: <span id="sent-by">' + feed_data[t].username + '</span></p><p>Type:' + feed_data[t].type + '</p><p>' + feed_data[t].date + '</p></div><div class="feed-cont"><p>' + feed_data[t].msg + '</p></div></div>'; itr++; worked++; } if (itr >= maxFeed) break; } if (z == 0 || worked == 0) container.innerHTML += '<p class="clicable" id="show-more">No Feeds yet</p>'; else container.innerHTML += '<p class="clicable" id="show-more" onclick="showMore()">Show More</p>'; worked = 0; } function showMore() { if (maxFeed >= feed_data.length) { alert("Thats All Feedback"); return; } maxFeed += 2; showFeeds(prevFilter); } function setType(type) { feed_type = type; } function send_Feed() { let data = { "username": curUser.username, "type": feed_type, "date": getDate(), "msg": document.getElementById("feed_msg").value }; if (data.msg.length == 0) { alert("Message Empty!"); return; } data.msg = data.msg.replace(/(<([^>]+)>)/ig,""); if (feed_type == null) { alert("Please Select Feedback Type"); return; } document.getElementById("feed_msg").value = ""; feed_data[feed_data.length] = data; stor_add("feed_data", JSON.stringify(feed_data)); prevFilter = data.type; dataLoad(); showFeeds(feed_type); } function getDate() { let t = new Date(); return t.getMonth() + 1 + "/" + t.getDate() + "/" + t.getFullYear(); } 
